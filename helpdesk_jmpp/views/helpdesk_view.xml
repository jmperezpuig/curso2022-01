<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_helpdesk_ticket_tree" model="ir.ui.view">
        <field name="name">view.helpdesk_ticket.tree</field>
        <field name="model">helpdesk.ticket</field>
        <field name="arch" type="xml">
            <tree string='Ticket'>
                <!-- Add your fields here -->
                <field name='nombre'/>
                <field name='fecha'/>
                <field name='state'/>
            </tree>
        </field>
    </record>

    <record id="view_helpdesk_ticket_form" model="ir.ui.view">
        <field name="name">view.helpdesk_ticket.form</field>
        <field name="model">helpdesk.ticket</field>
        <field name="arch" type="xml">
            <form string="Ticket">
                <header>
                    <!-- cambia el estado a asignado y pone a true el campo asignado. Solo visible para nuevo -->
                    <button string='Asignar' name='asignar' type='object' states='nuevo'/>
                    <!-- ticket en proceso. Solo visible para estado=asignado -->
                    <button string='En proceso' name='proceso' type='object' states='asignado'/>
                    <!-- ticket pendiente. Solo visible para estados=en proceso y asignado -->
                    <button string='Pendiente' name='pendiente' type='object' states='proceso,asignado'/>
                    <!-- Finalizar. Visible en cualquier estado salvo en cancelado y finalizado -->
                    <button string='Finalizar' name='finalizar' type='object' states='nuevo,asignado,proceso,pendiente,resuelto'/>
                    <!-- Cancelar. Solo visible si no está cancelado o finalizado -->
                    <button string='Cancelar' name='cancelar' type='object' states='nuevo,asignado,proceso,pendiente,resuelto'/>

                    <field name="state" widget="statusbar"/>
                </header>
                
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="nombre"/>
                        </h1>
                    </div>
                    <div>
                    <group>
                        <group>
                            <field name="fecha"/>
                            <field name="fecha_limite"/>
                        </group>
                        <group>
                            <!-- añadimmos para ver el usuario -->
                            <field name="user_id" options="{'no_create': True, 'no_open': True}"/> 
                            <field name="asignado"/>
                            <field name="ticket_qty"/><!-- para hacer lo del final del v7 -->
                            <field name="tiempo" widget='float_time'/>
                        </group>
                    </group>
                    </div>
                    <notebook>
                        <page string="Descripción">
                            <field name="descripcion"/>
                            <!-- para hacer lo del final del v7 -->
                            <group>
                                <field name="tag_name"/>
                                <button name="create_tag" type="object" string="Crear tag"/>
                            </group>
                            <!-- añadimos para ver los tag desde Ticket -->
                            <field name="tag_ids" context="{'form_view_ref': 'helpdesk_jmpp.view_helpdesk_ticket_tag_simple_form'}"/>
                        </page>
                        <!-- añadimos page para las Actions -->
                        <page string='Acciones'>
                            <field name="action_ids" context="{'default_date': fecha}">
                                <!-- para la vista embebida -->
                                <tree editable='bottom'>
                                    <field name="name"/>
                                    <field name="date"/>
                                    <field name="time"/>
                                </tree>
                                <form editable='bottom'>
                                    <group name='action'>
                                        <field name="name"/>
                                        <field name="date"/>
                                        <field name="time"/>
                                    </group>
                                </form>
                            </field>
                        </page>
                        <page string="Calidad">
                            
                            <label for="accion_correctiva"/>
                            <field name="accion_correctiva"/>
                            <group string='Acción Preventiva'>
                                <field name="accion_preventiva" nolabel='1'/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_helpdesk_ticket_search" model="ir.ui.view">
        <field name="name">view.helpdesk_ticket.search</field>
        <field name="model">helpdesk.ticket</field>
        <field name="arch" type="xml">
            <search string='Ticket'>
                <!-- Add your fields here -->
                <field name='nombre'/>
                <field name='user_id'/>
                <filter string='Asignados' name='asignado' domain="[('user_id','!=',False)]"/>
                <filter string='Sin fecha límite' name='fecha_limite' domain="[('fecha_limite','=',False)]"/>
                <filter string='Fecha límite' name='fecha_limite' context="{'group_by': 'fecha_limite'}"/>
                <filter string='Asignado a' name='user_id' context="{'group_by': 'user_id'}"/>
            </search>
        </field>
    </record>


    <record id="view_helpdesk_ticket_pivot" model="ir.ui.view">
        <field name="name">view.helpdesk_ticket.pivot</field>
        <field name="model">helpdesk.ticket</field>
        <field name="arch" type="xml">
            <pivot string='Ticket'>
                <field name='user_id' type='row'/>
                <field name='fecha' interval='month' type='col'/>
                <field name='tiempo' type='measure' widget='float_time'/>
            </pivot>
        </field>
    </record>


    <record id="view_helpdesk_ticket_graph" model="ir.ui.view">
        <field name="name">view.helpdesk_ticket.graph</field>
        <field name="model">helpdesk.ticket</field>
        <field name="arch" type="xml">
            <graph string='Ticket'>
                <field name='user_id'/>
                <field name='tiempo' type='measure' widget='float_time'/>
            </graph>
        </field>
    </record>

    <record id="view_helpdesk_ticket_calendar" model="ir.ui.view">
        <field name="name">view.helpdesk_ticket.calendar</field>
        <field name="model">helpdesk.ticket</field>
        <field name="arch" type="xml">
            <calendar string='Tickets' date_start='fecha' color='user_id' hide_time='true' event_limit='5'>
                <field name='user_id' avatar_field='image_128'/>
                <field name='nombre'/>
                <field name='user_id' filters='1' invisible='1'/>
            </calendar>
        </field>
    </record>

    <record id="view_helpdesk_ticket_kanban" model="ir.ui.view">
        <field name="name">view.helpdesk_ticket.kanban</field>
        <field name="model">helpdesk.ticket</field>
        <field name="arch" type="xml">
            <kanban default_group_by='user_id'>
                <templates>
                    <t t-name='kanban-box'>
                        <div t-attf-class='oe_kanban_content oe_kanban_global_click'>
                            <div class='o_kanban_record_title'>
                                <strong><field name='nombre'/></strong>
                            </div>
                            <div class='o_kanban_record_subtitle'>
                                <field name='fecha'/>
                                <field name='tiempo'/>
                            </div>
                            <div class='o_kanban_record_bottom'>
                                <div class='oe_kanban_bottom_right'>
                                    <field name='user_id' widget='many2one_avatar_user'/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

</odoo>